"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkTargets = void 0;
const devkit_1 = require("@nrwl/devkit");
/**
 * Check whether the project to be removed has builders targetted by another project
 *
 * Throws an error if the project is in use, unless the `--forceRemove` option is used.
 *
 * @param schema The options provided to the schematic
 */
function checkTargets(tree, schema) {
    if (schema.forceRemove) {
        return;
    }
    const usedIn = [];
    devkit_1.getProjects(tree).forEach((project, projectName) => {
        const findTarget = new RegExp(`${schema.projectName}:`);
        if (projectName === schema.projectName) {
            return;
        }
        if (findTarget.test(JSON.stringify(project))) {
            usedIn.push(projectName);
        }
    });
    if (usedIn.length > 0) {
        let message = `${schema.projectName} is still targeted by the following projects:\n\n`;
        for (let project of usedIn) {
            message += `${project}\n`;
        }
        throw new Error(message);
    }
}
exports.checkTargets = checkTargets;
//# sourceMappingURL=check-targets.js.map