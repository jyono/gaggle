"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkDependencies = void 0;
const project_graph_1 = require("../../../core/project-graph");
const create_project_graph_from_tree_1 = require("../../../utilities/create-project-graph-from-tree");
/**
 * Check whether the project to be removed is depended on by another project
 *
 * Throws an error if the project is in use, unless the `--forceRemove` option is used.
 */
function checkDependencies(tree, schema) {
    if (schema.forceRemove) {
        return;
    }
    const graph = create_project_graph_from_tree_1.createProjectGraphFromTree(tree);
    const reverseGraph = project_graph_1.onlyWorkspaceProjects(project_graph_1.reverse(graph));
    const deps = reverseGraph.dependencies[schema.projectName] || [];
    if (deps.length === 0) {
        return;
    }
    throw new Error(`${schema.projectName} is still depended on by the following projects:\n${deps
        .map((x) => x.target)
        .join('\n')}`);
}
exports.checkDependencies = checkDependencies;
//# sourceMappingURL=check-dependencies.js.map