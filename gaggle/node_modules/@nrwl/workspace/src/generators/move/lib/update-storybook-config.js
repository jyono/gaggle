"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateStorybookConfig = void 0;
const path = require("path");
const app_root_1 = require("../../../utilities/app-root");
const utils_1 = require("./utils");
const path_1 = require("path");
/**
 * Updates relative path to root storybook config for `main.js` & `webpack.config.js`
 *
 * @param schema The options provided to the schematic
 */
function updateStorybookConfig(tree, schema, project) {
    const destination = utils_1.getDestination(tree, schema, project);
    const oldRelativeRoot = path
        .relative(path.join(app_root_1.appRootPath, `${project.root}/.storybook`), app_root_1.appRootPath)
        .split(path.sep)
        .join('/');
    const newRelativeRoot = path
        .relative(path.join(app_root_1.appRootPath, `${destination}/.storybook`), app_root_1.appRootPath)
        .split(path.sep)
        .join('/');
    const storybookDir = path.join(destination, '.storybook');
    if (!storybookDir) {
        return;
    }
    // Replace relative import path to root storybook folder for each file under project storybook
    for (const file of tree.children(storybookDir)) {
        const oldContent = tree.read(path_1.join(storybookDir, file)).toString('utf-8');
        const newContent = oldContent.replace(oldRelativeRoot, newRelativeRoot);
        tree.write(path_1.join(storybookDir, file), newContent);
    }
}
exports.updateStorybookConfig = updateStorybookConfig;
//# sourceMappingURL=update-storybook-config.js.map