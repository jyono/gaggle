"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.report = exports.packagesWeCareAbout = void 0;
const chalk = require("chalk");
const child_process_1 = require("child_process");
const fs_1 = require("fs");
const app_root_1 = require("../utilities/app-root");
const package_manager_1 = require("@nrwl/tao/src/shared/package-manager");
const output_1 = require("../utilities/output");
exports.packagesWeCareAbout = [
    'nx',
    '@nrwl/angular',
    '@nrwl/cli',
    '@nrwl/cypress',
    '@nrwl/devkit',
    '@nrwl/eslint-plugin-nx',
    '@nrwl/express',
    '@nrwl/jest',
    '@nrwl/linter',
    '@nrwl/nest',
    '@nrwl/next',
    '@nrwl/node',
    '@nrwl/react',
    '@nrwl/schematics',
    '@nrwl/tao',
    '@nrwl/web',
    '@nrwl/workspace',
    '@nrwl/storybook',
    '@nrwl/gatsby',
    'typescript',
];
exports.report = {
    command: 'report',
    describe: 'Reports useful version numbers to copy into the Nx issue template',
    builder: (yargs) => yargs,
    handler: reportHandler,
};
/**
 * Reports relevant version numbers for adding to an Nx issue report
 *
 * @remarks
 *
 * Must be run within an Nx workspace
 *
 */
function reportHandler() {
    const pm = package_manager_1.detectPackageManager();
    const pmVersion = child_process_1.execSync(`${pm} --version`).toString('utf-8').trim();
    const bodyLines = [
        `Node : ${process.versions.node}`,
        `OS   : ${process.platform} ${process.arch}`,
        `${pm.padEnd(5)}: ${pmVersion}`,
        ``,
    ];
    exports.packagesWeCareAbout.forEach((p) => {
        let status = 'Not Found';
        try {
            const packageJsonPath = require.resolve(`${p}/package.json`, {
                paths: [app_root_1.appRootPath],
            });
            const packageJson = JSON.parse(fs_1.readFileSync(packageJsonPath).toString());
            status = packageJson.version;
        }
        catch (_a) { }
        bodyLines.push(`${chalk.green(p)} : ${chalk.bold(status)}`);
    });
    output_1.output.log({
        title: 'Report complete - copy this into the issue template',
        bodyLines,
    });
}
//# sourceMappingURL=report.js.map